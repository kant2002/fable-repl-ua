import{fromValue,ticksToUnixEpochMilliseconds,unixEpochMillisecondsToTicks}from"./Long.js";import{compareDates,dateOffset,padWithZeros}from"./Util.js";export function dateOffsetToString(e){const t=e<0,n=(e=Math.abs(e))%36e5/6e4;return(t?"-":"+")+padWithZeros(~~(e/36e5),2)+":"+padWithZeros(n,2)}export function dateToHalfUTCString(e,t){const n=e.toISOString();return"first"===t?n.substring(0,n.indexOf("T")):n.substring(n.indexOf("T")+1,n.length-1)}function dateToISOString(e,t){if(t)return e.toISOString();{const t=null==e.kind||2===e.kind;return padWithZeros(e.getFullYear(),4)+"-"+padWithZeros(e.getMonth()+1,2)+"-"+padWithZeros(e.getDate(),2)+"T"+padWithZeros(e.getHours(),2)+":"+padWithZeros(e.getMinutes(),2)+":"+padWithZeros(e.getSeconds(),2)+"."+padWithZeros(e.getMilliseconds(),3)+(t?dateOffsetToString(-6e4*e.getTimezoneOffset()):"")}}function dateToISOStringWithOffset(e,t){const n=e.toISOString();return n.substring(0,n.length-1)+dateOffsetToString(t)}function dateToStringWithCustomFormat(e,t,n){return t.replace(/(\w)\1*/g,(t=>{let r=Number.NaN;switch(t.substring(0,1)){case"y":const o=n?e.getUTCFullYear():e.getFullYear();r=t.length<4?o%100:o;break;case"M":r=(n?e.getUTCMonth():e.getMonth())+1;break;case"d":r=n?e.getUTCDate():e.getDate();break;case"H":r=n?e.getUTCHours():e.getHours();break;case"h":const i=n?e.getUTCHours():e.getHours();r=i>12?i%12:i;break;case"m":r=n?e.getUTCMinutes():e.getMinutes();break;case"s":r=n?e.getUTCSeconds():e.getSeconds();break;case"f":r=n?e.getUTCMilliseconds():e.getMilliseconds()}return Number.isNaN(r)?t:padWithZeros(r,t.length)}))}function dateToStringWithOffset(e,t){var n,r,o;const i=new Date(e.getTime()+(null!==(n=e.offset)&&void 0!==n?n:0));if("string"!=typeof t)return i.toISOString().replace(/\.\d+/,"").replace(/[A-Z]|\.\d+/g," ")+dateOffsetToString(null!==(r=e.offset)&&void 0!==r?r:0);if(1!==t.length)return dateToStringWithCustomFormat(i,t,!0);switch(t){case"D":case"d":return dateToHalfUTCString(i,"first");case"T":case"t":return dateToHalfUTCString(i,"second");case"O":case"o":return dateToISOStringWithOffset(i,null!==(o=e.offset)&&void 0!==o?o:0);default:throw new Error("Unrecognized Date print format")}}function dateToStringWithKind(e,t){const n=1===e.kind;if("string"!=typeof t)return n?e.toUTCString():e.toLocaleString();if(1!==t.length)return dateToStringWithCustomFormat(e,t,n);switch(t){case"D":case"d":return n?dateToHalfUTCString(e,"first"):e.toLocaleDateString();case"T":case"t":return n?dateToHalfUTCString(e,"second"):e.toLocaleTimeString();case"O":case"o":return dateToISOString(e,n);default:throw new Error("Unrecognized Date print format")}}export function toString(e,t,n){return null!=e.offset?dateToStringWithOffset(e,t):dateToStringWithKind(e,t)}export function DateTime(e,t){const n=new Date(e);return n.kind=0|(null==t?0:t),n}export function fromTicks(e,t){e=fromValue(e),t=null!=t?t:2;let n=DateTime(ticksToUnixEpochMilliseconds(e),t);return 1!==t&&(n=DateTime(n.getTime()-dateOffset(n),t)),n}export function fromDateTimeOffset(e,t){var n;switch(t){case 1:return DateTime(e.getTime(),1);case 2:return DateTime(e.getTime(),2);default:const r=DateTime(e.getTime()+(null!==(n=e.offset)&&void 0!==n?n:0),t);return DateTime(r.getTime()-dateOffset(r),t)}}export function getTicks(e){return unixEpochMillisecondsToTicks(e.getTime(),dateOffset(e))}export function minValue(){return DateTime(-621355968e5,0)}export function maxValue(){return DateTime(0xe677d21fdbff,0)}export function parseRaw(e){function t(){throw new Error(`The string is not a valid Date: ${e}`)}null!=e&&""!==e.trim()||t(),10===e.length&&"-"===e[4]&&"-"===e[7]&&(e+="T00:00:00");let n=new Date(e),r=null;if(isNaN(n.getTime())){const o=/^\s*(\d+[^\w\s:]\d+[^\w\s:]\d+)?\s*(\d+:\d+(?::\d+(?:\.\d+)?)?)?\s*([AaPp][Mm])?\s*(Z|[+-]([01]?\d):?([0-5]?\d)?)?\s*$/.exec(e);if(null!=o){let e,t=0;if(null!=o[2]){const e=o[2].split(":");t=3600*parseInt(e[0],10)+60*parseInt(e[1]||"0",10)+parseFloat(e[2]||"0"),null!=o[3]&&"PM"===o[3].toUpperCase()&&(t+=720)}if(null!=o[4]){if(null!=o[1])e=new Date(o[1]+" UTC");else{const t=new Date;e=new Date(t.getUTCFullYear()+"/"+(t.getUTCMonth()+1)+"/"+t.getUTCDate())}if("Z"===o[4])r="Z";else{let e=60*parseInt(o[5],10)+parseInt(o[6]||"0",10);"-"===o[4][0]&&(e*=-1),r=e,t-=60*e}}else if(null!=o[1])e=new Date(o[1]);else{const t=new Date;e=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate())}n=new Date(e.getTime()+1e3*t),n=new Date(n.getTime()+6e4*(n.getTimezoneOffset()-e.getTimezoneOffset()))}else t();isNaN(n.getTime())&&t()}return[n,r]}export function parse(e,t=!1){const[n,r]=parseRaw(e),o=null!=r?t&&"Z"===r?1:2:0;return DateTime(n.getTime(),o)}export function tryParse(e,t){try{return t.contents=parse(e),!0}catch(e){return!1}}export function create(e,t,n,r=0,o=0,i=0,a=0,s){const u=1===s?new Date(Date.UTC(e,t-1,n,r,o,i,a)):new Date(e,t-1,n,r,o,i,a);e<=99&&(1===s?u.setUTCFullYear(e,t-1,n):u.setFullYear(e,t-1,n));const c=u.getTime();if(isNaN(c))throw new Error("The parameters describe an unrepresentable Date.");return DateTime(c,s)}export function now(){return DateTime(Date.now(),2)}export function utcNow(){return DateTime(Date.now(),1)}export function today(){return date(now())}export function isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}export function daysInMonth(e,t){return 2===t?isLeapYear(e)?29:28:t>=8?t%2==0?31:30:t%2==0?30:31}export function toUniversalTime(e){return 1===e.kind?e:DateTime(e.getTime(),1)}export function toLocalTime(e){return 2===e.kind?e:DateTime(e.getTime(),2)}export function specifyKind(e,t){return create(year(e),month(e),day(e),hour(e),minute(e),second(e),millisecond(e),t)}export function timeOfDay(e){return 36e5*hour(e)+6e4*minute(e)+1e3*second(e)+millisecond(e)}export function date(e){return create(year(e),month(e),day(e),0,0,0,0,e.kind)}export function day(e){return 1===e.kind?e.getUTCDate():e.getDate()}export function hour(e){return 1===e.kind?e.getUTCHours():e.getHours()}export function millisecond(e){return 1===e.kind?e.getUTCMilliseconds():e.getMilliseconds()}export function minute(e){return 1===e.kind?e.getUTCMinutes():e.getMinutes()}export function month(e){return(1===e.kind?e.getUTCMonth():e.getMonth())+1}export function second(e){return 1===e.kind?e.getUTCSeconds():e.getSeconds()}export function year(e){return 1===e.kind?e.getUTCFullYear():e.getFullYear()}export function dayOfWeek(e){return 1===e.kind?e.getUTCDay():e.getDay()}export function dayOfYear(e){const t=year(e),n=month(e);let r=day(e);for(let e=1;e<n;e++)r+=daysInMonth(t,e);return r}export function add(e,t){const n=DateTime(e.getTime()+t,e.kind);if(2===e.kind){const t=e.getTimezoneOffset(),r=n.getTimezoneOffset();return t!==r?DateTime(n.getTime()+6e4*(r-t),e.kind):n}return n}export function addDays(e,t){return add(e,864e5*t)}export function addHours(e,t){return add(e,36e5*t)}export function addMinutes(e,t){return add(e,6e4*t)}export function addSeconds(e,t){return add(e,1e3*t)}export function addMilliseconds(e,t){return add(e,t)}export function addYears(e,t){const n=month(e),r=year(e)+t,o=daysInMonth(r,n);return create(r,n,Math.min(o,day(e)),hour(e),minute(e),second(e),millisecond(e),e.kind)}export function addMonths(e,t){let n=month(e)+t,r=0,o=0;n>12?(r=n%12,o=Math.floor(n/12),n=r):n<1&&(r=12+n%12,o=Math.floor(n/12)+(12===r?-1:0),n=r);const i=year(e)+o,a=daysInMonth(i,n);return create(i,n,Math.min(a,day(e)),hour(e),minute(e),second(e),millisecond(e),e.kind)}export function subtract(e,t){return"number"==typeof t?add(e,-t):e.getTime()-t.getTime()}export function toLongDateString(e){return e.toDateString()}export function toShortDateString(e){return e.toLocaleDateString()}export function toLongTimeString(e){return e.toLocaleTimeString()}export function toShortTimeString(e){return e.toLocaleTimeString().replace(/:\d\d(?!:)/,"")}export function equals(e,t){return e.getTime()===t.getTime()}export const compare=compareDates;export const compareTo=compareDates;export function op_Addition(e,t){return add(e,t)}export function op_Subtraction(e,t){return subtract(e,t)}export function isDaylightSavingTime(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1);return isDST(t.getTimezoneOffset(),n.getTimezoneOffset(),e.getTimezoneOffset())}function isDST(e,t,n){return Math.min(e,t)===n}export default DateTime;