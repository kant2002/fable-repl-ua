import{create as createDate,dateOffsetToString,daysInMonth,parseRaw}from"./Date.js";import{fromValue,ticksToUnixEpochMilliseconds,unixEpochMillisecondsToTicks}from"./Long.js";import{compareDates,padWithZeros}from"./Util.js";export default function DateTimeOffset(e,t){checkOffsetInRange(t);const n=new Date(e);return n.offset=null!=t?t:-6e4*(new Date).getTimezoneOffset(),n}function checkOffsetInRange(e){if(null!=e&&0!==e){if(e%6e4!=0)throw new Error("Offset must be specified in whole minutes.");if(Math.abs(e/36e5)>14)throw new Error("Offset must be within plus or minus 14 hours.")}}export function fromDate(e,t){let n=0;switch(e.kind){case 1:if(null!=t&&0!==t)throw new Error("The UTC Offset for Utc DateTime instances must be 0.");n=0;break;case 2:if(n=-6e4*e.getTimezoneOffset(),null!=t&&t!==n)throw new Error("The UTC Offset of the local dateTime parameter does not match the offset argument.");break;default:n=null==t?-6e4*e.getTimezoneOffset():t}return DateTimeOffset(e.getTime(),n)}export function fromTicks(e,t){return e=fromValue(e),DateTimeOffset(ticksToUnixEpochMilliseconds(e)-t,t)}export function getUtcTicks(e){return unixEpochMillisecondsToTicks(e.getTime(),0)}export function minValue(){return DateTimeOffset(-621355968e5,0)}export function maxValue(){return DateTimeOffset(0xe677d21fdbff,0)}export function parse(e){const[t,n]=parseRaw(e),o=null==n?-6e4*t.getTimezoneOffset():"Z"===n?0:6e4*n;return DateTimeOffset(t.getTime(),o)}export function tryParse(e,t){try{return t.contents=parse(e),!0}catch(e){return!1}}export function create(e,t,n,o,r,i,f,a){let s;if(null==a&&(a=f,f=0),checkOffsetInRange(a),0===a)s=new Date(Date.UTC(e,t-1,n,o,r,i,f)),e<=99&&s.setUTCFullYear(e,t-1,n);else{const u=padWithZeros(e,4)+"-"+padWithZeros(t,2)+"-"+padWithZeros(n,2)+"T"+padWithZeros(o,2)+":"+padWithZeros(r,2)+":"+padWithZeros(i,2)+"."+padWithZeros(f,3)+dateOffsetToString(a);s=new Date(u)}const u=s.getTime();if(isNaN(u))throw new Error("The parameters describe an unrepresentable Date");return DateTimeOffset(u,a)}export function now(){const e=new Date,t=-6e4*e.getTimezoneOffset();return DateTimeOffset(e.getTime(),t)}export function utcNow(){return DateTimeOffset(now().getTime(),0)}export function toUniversalTime(e){return DateTimeOffset(e.getTime(),0)}export function toLocalTime(e){return DateTimeOffset(e.getTime(),-6e4*e.getTimezoneOffset())}export function timeOfDay(e){var t;const n=new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0));return 36e5*n.getUTCHours()+6e4*n.getUTCMinutes()+1e3*n.getUTCSeconds()+n.getUTCMilliseconds()}export function date(e){var t;const n=new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0));return createDate(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),0,0,0,0)}export function day(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCDate()}export function hour(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCHours()}export function millisecond(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCMilliseconds()}export function minute(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCMinutes()}export function month(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCMonth()+1}export function second(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCSeconds()}export function year(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCFullYear()}export function dayOfWeek(e){var t;return new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)).getUTCDay()}export function dayOfYear(e){var t;const n=new Date(e.getTime()+(null!==(t=e.offset)&&void 0!==t?t:0)),o=n.getUTCFullYear(),r=n.getUTCMonth()+1;let i=n.getUTCDate();for(let e=1;e<r;e++)i+=daysInMonth(o,e);return i}export function add(e,t){var n;return DateTimeOffset(e.getTime()+t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addDays(e,t){var n;return DateTimeOffset(e.getTime()+864e5*t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addHours(e,t){var n;return DateTimeOffset(e.getTime()+36e5*t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addMinutes(e,t){var n;return DateTimeOffset(e.getTime()+6e4*t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addSeconds(e,t){var n;return DateTimeOffset(e.getTime()+1e3*t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addMilliseconds(e,t){var n;return DateTimeOffset(e.getTime()+t,null!==(n=e.offset)&&void 0!==n?n:0)}export function addYears(e,t){var n;const o=e.getUTCMonth()+1,r=e.getUTCFullYear()+t,i=daysInMonth(r,o);return create(r,o,Math.min(i,e.getUTCDate()),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds(),null!==(n=e.offset)&&void 0!==n?n:0)}export function addMonths(e,t){var n,o;const r=new Date(e.getTime()+(null!==(n=e.offset)&&void 0!==n?n:0));let i=r.getUTCMonth()+1+t,f=0,a=0;i>12?(f=i%12,a=Math.floor(i/12),i=f):i<1&&(f=12+i%12,a=Math.floor(i/12)+(12===f?-1:0),i=f);const s=r.getUTCFullYear()+a,u=daysInMonth(s,i);return create(s,i,Math.min(u,r.getUTCDate()),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds(),null!==(o=e.offset)&&void 0!==o?o:0)}export function subtract(e,t){var n;return"number"==typeof t?DateTimeOffset(e.getTime()-t,null!==(n=e.offset)&&void 0!==n?n:0):e.getTime()-t.getTime()}export function equals(e,t){return e.getTime()===t.getTime()}export function equalsExact(e,t){return e.getTime()===t.getTime()&&e.offset===t.offset}export function compare(e,t){return compareDates(e,t)}export const compareTo=compare;export function op_Addition(e,t){return add(e,t)}export function op_Subtraction(e,t){return subtract(e,t)}export function toOffset(e,t){return DateTimeOffset(e.getTime(),t)}