import{combineHashCodes}from"../Util.js";import{symbol}from"../Numeric.js";var P={GetHashCode(){return combineHashCodes([this.s,this.e].concat(this.c))},Equals(r){return!this.cmp(r)},CompareTo(r){return this.cmp(r)},[symbol](){const r=this;return{multiply:t=>r.mul(t),toPrecision:t=>r.toPrecision(t),toExponential:t=>r.toExponential(t),toFixed:t=>r.toFixed(t),toHex:()=>(Number(r)>>>0).toString(16)}}},DP=28,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-29,PE=29,STRICT=!1,NAME="[big.js] ",INVALID=NAME+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME+"Division by zero",UNDEFINED=void 0,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function r(t){var e=this;if(!(e instanceof r))return t===UNDEFINED?_Big_():new r(t);if(t instanceof r)e.s=t.s,e.e=t.e,e.c=t.c.slice(),normalize(e);else{if("string"!=typeof t){if(!0===r.strict)throw TypeError(INVALID+"number");t=0===t&&1/t<0?"-0":String(t)}parse(e,t)}e.constructor=r}return r.prototype=P,r.DP=DP,r.RM=RM,r.NE=NE,r.PE=PE,r.strict=STRICT,r}function normalize(r){if(r.c.length>1&&!r.c[0]){let t=r.c.findIndex((r=>r));r.c=r.c.slice(t),r.e=r.e-t}}function parse(r,t){var e,n,i;if(!NUMERIC.test(t))throw Error(INVALID+"number");for(r.s="-"==t.charAt(0)?(t=t.slice(1),-1):1,(e=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(e<0&&(e=n),e+=+t.slice(n+1),t=t.substring(0,n)):e<0&&(e=t.length),i=t.length,n=0;n<e&&n<i&&"0"==t.charAt(n);)++n;if(n==i)r.c=[r.e=0];else for(r.e=e-n-1,r.c=[],e=0;n<i;)r.c[e++]=+t.charAt(n++);return round(r,Big.DP+1,Big.RM)}function round(r,t,e,n){var i=r.c;if(e===UNDEFINED&&(e=Big.RM),0!==e&&1!==e&&2!==e&&3!==e)throw Error(INVALID_RM);if(t<1)n=3===e&&(n||!!i[0])||0===t&&(1===e&&i[0]>=5||2===e&&(i[0]>5||5===i[0]&&(n||i[1]!==UNDEFINED))),i.length=1,n?(r.e=r.e-t+1,i[0]=1):i[0]=r.e=0;else if(t<i.length){const o=i.findIndex(((r,e)=>e>=t&&r>0))<0;if(n=1===e&&i[t]>=5||2===e&&(i[t]>5||5===i[t]&&(n||i[t+1]!==UNDEFINED||1&i[t-1]))||3===e&&(n||!o),i.length=t--,n)for(;++i[t]>9;)i[t]=0,t--||(++r.e,i.unshift(1));for(t=i.length;!i[--t];)i.pop()}return r}function stringify(r,t,e){var n=r.e,i=r.c.join(""),o=i.length;if(t)i=i.charAt(0)+(o>1?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)i="0"+i;i="0."+i}else if(n>0)if(++n>o)for(n-=o;n--;)i+="0";else n<o&&(i=i.slice(0,n)+"."+i.slice(n));else o>1&&(i=i.charAt(0)+"."+i.slice(1));return r.s<0&&e?"-"+i:i}P.abs=function(){var r=new this.constructor(this);return r.s=1,r},P.cmp=function(r){var t,e=this.constructor,n=new e(this),i=(r=new e(r),n.c),o=r.c,s=n.s,c=r.s,f=n.e,u=r.e;if(!i[0]||!o[0])return i[0]?s:o[0]?-c:0;if(s!=c)return s;if(t=s<0,f!=u)return f>u^t?1:-1;for(c=Math.max(i.length,o.length),s=0;s<c;s++)if((f=s<i.length?i[s]:0)!=(u=s<o.length?o[s]:0))return f>u^t?1:-1;return 0},P.div=function(r){var t=this.constructor,e=new t(this),n=(r=new t(r),e.c),i=r.c,o=e.s==r.s?1:-1,s=t.DP;if(s!==~~s||s<0||s>MAX_DP)throw Error(INVALID_DP);if(!i[0])throw Error(DIV_BY_ZERO);if(!n[0])return r.s=o,r.c=[r.e=0],r;var c,f,u,h,l,E=i.slice(),a=c=i.length,D=n.length,P=n.slice(0,c),g=P.length,N=r,I=N.c=[],p=0,w=s+(N.e=e.e-r.e)+1;for(N.s=o,o=w<0?0:w,E.unshift(0);g++<c;)P.push(0);do{for(u=0;u<10;u++){if(c!=(g=P.length))h=c>g?1:-1;else for(l=-1,h=0;++l<c;)if(i[l]!=P[l]){h=i[l]>P[l]?1:-1;break}if(!(h<0))break;for(f=g==c?i:E;g;){if(P[--g]<f[g]){for(l=g;l&&!P[--l];)P[l]=9;--P[l],P[g]+=10}P[g]-=f[g]}for(;!P[0];)P.shift()}I[p++]=h?u:++u,P[0]&&h?P[g]=n[a]||0:P=[n[a]]}while((a++<D||P[0]!==UNDEFINED)&&o--);return I[0]||1==p||(I.shift(),N.e--,w--),p>w&&round(N,w,t.RM,P[0]!==UNDEFINED),N},P.eq=function(r){return 0===this.cmp(r)},P.gt=function(r){return this.cmp(r)>0},P.gte=function(r){return this.cmp(r)>-1},P.lt=function(r){return this.cmp(r)<0},P.lte=function(r){return this.cmp(r)<1},P.minus=P.sub=function(r){var t,e,n,i,o=this.constructor,s=new o(this),c=(r=new o(r),s.s),f=r.s;if(c!=f)return r.s=-f,s.plus(r);var u=s.c.slice(),h=s.e,l=r.c,E=r.e;if(!u[0]||!l[0])return l[0]?r.s=-f:u[0]?r=new o(s):r.s=1,r;if(c=h-E){for((i=c<0)?(c=-c,n=u):(E=h,n=l),n.reverse(),f=c;f--;)n.push(0);n.reverse()}else for(e=((i=u.length<l.length)?u:l).length,c=f=0;f<e;f++)if(u[f]!=l[f]){i=u[f]<l[f];break}if(i&&(n=u,u=l,l=n,r.s=-r.s),(f=(e=l.length)-(t=u.length))>0)for(;f--;)u[t++]=0;for(f=t;e>c;){if(u[--e]<l[e]){for(t=e;t&&!u[--t];)u[t]=9;--u[t],u[e]+=10}u[e]-=l[e]}for(;0===u[--f];)u.pop();for(;0===u[0];)u.shift(),--E;return u[0]||(r.s=1,u=[E=0]),r.c=u,r.e=E,r},P.mod=function(r){var t,e=this.constructor,n=new e(this),i=(r=new e(r),n.s),o=r.s;if(!r.c[0])throw Error(DIV_BY_ZERO);return n.s=r.s=1,t=1==r.cmp(n),n.s=i,r.s=o,t?new e(n):(i=e.DP,o=e.RM,e.DP=e.RM=0,n=n.div(r),e.DP=i,e.RM=o,this.minus(n.times(r)))},P.plus=P.add=function(r){var t,e,n,i=this.constructor,o=new i(this);if(r=new i(r),o.s!=r.s)return r.s=-r.s,o.minus(r);var s=o.e,c=o.c,f=r.e,u=r.c;if(!c[0]||!u[0])return u[0]||(c[0]?r=new i(o):r.s=o.s),r;if(c=c.slice(),t=s-f){for(t>0?(f=s,n=u):(t=-t,n=c),n.reverse();t--;)n.push(0);n.reverse()}for(c.length-u.length<0&&(n=u,u=c,c=n),t=u.length,e=0;t;c[t]%=10)e=(c[--t]=c[t]+u[t]+e)/10|0;for(e&&(c.unshift(e),++f),t=c.length;0===c[--t];)c.pop();return r.c=c,r.e=f,r},P.pow=function(r){var t=this.constructor,e=new t(this),n=new t("1"),i=new t("1"),o=r<0;if(r!==~~r||r<-MAX_POWER||r>MAX_POWER)throw Error(INVALID+"exponent");for(o&&(r=-r);1&r&&(n=n.times(e)),r>>=1;)e=e.times(e);return o?i.div(n):n},P.prec=function(r,t){if(r!==~~r||r<1||r>MAX_DP)throw Error(INVALID+"precision");return round(new this.constructor(this),r,t)},P.round=function(r,t){if(r===UNDEFINED)r=0;else if(r!==~~r||r<-MAX_DP||r>MAX_DP)throw Error(INVALID_DP);return round(new this.constructor(this),r+this.e+1,t)},P.sqrt=function(){var r,t,e,n=this.constructor,i=new n(this),o=i.s,s=i.e,c=new n("0.5");if(!i.c[0])return new n(i);if(o<0)throw Error(NAME+"No square root");0===(o=Math.sqrt(i+""))||o===1/0?((t=i.c.join("")).length+s&1||(t+="0"),s=((s+1)/2|0)-(s<0||1&s),r=new n(((o=Math.sqrt(t))==1/0?"5e":(o=o.toExponential()).slice(0,o.indexOf("e")+1))+s)):r=new n(o+""),s=r.e+(n.DP+=4);do{e=r,r=c.times(e.plus(i.div(e)))}while(e.c.slice(0,s).join("")!==r.c.slice(0,s).join(""));return round(r,(n.DP-=4)+r.e+1,n.RM)},P.times=P.mul=function(r){var t,e=this.constructor,n=new e(this),i=(r=new e(r),n.c),o=r.c,s=i.length,c=o.length,f=n.e,u=r.e;if(r.s=n.s==r.s?1:-1,!i[0]||!o[0])return r.c=[r.e=0],r;for(r.e=f+u,s<c&&(t=i,i=o,o=t,u=s,s=c,c=u),t=new Array(u=s+c);u--;)t[u]=0;for(f=c;f--;){for(c=0,u=s+f;u>f;)c=t[u]+o[f]*i[u-f-1]+c,t[u--]=c%10,c=c/10|0;t[u]=c}for(c?++r.e:t.shift(),f=t.length;!t[--f];)t.pop();return r.c=t,r},P.toExponential=function(r,t){var e=this,n=e.c[0];if(r!==UNDEFINED){if(r!==~~r||r<0||r>MAX_DP)throw Error(INVALID_DP);for(e=round(new e.constructor(e),++r,t);e.c.length<r;)e.c.push(0)}return stringify(e,!0,!!n)},P.toFixed=function(r,t){var e=this,n=e.c[0];if(r!==UNDEFINED){if(r!==~~r||r<0||r>MAX_DP)throw Error(INVALID_DP);for(r=r+(e=round(new e.constructor(e),r+e.e+1,t)).e+1;e.c.length<r;)e.c.push(0)}return stringify(e,!1,!!n)},P.toJSON=P.toString=function(){var r=this,t=r.constructor;return stringify(r,r.e<=t.NE||r.e>=t.PE,!!r.c[0])},P.toNumber=function(){var r=Number(stringify(this,!0,!0));if(!0===this.constructor.strict&&!this.eq(r.toString()))throw Error(NAME+"Imprecise conversion");return r},P.toPrecision=function(r,t){var e=this,n=e.constructor,i=e.c[0];if(r!==UNDEFINED){if(r!==~~r||r<1||r>MAX_DP)throw Error(INVALID+"precision");for(e=round(new n(e),r,t);e.c.length<r;)e.c.push(0)}return stringify(e,r<=e.e||e.e<=n.NE||e.e>=n.PE,!!i)},P.valueOf=function(){var r=this,t=r.constructor;if(!0===t.strict)throw Error(NAME+"valueOf disallowed");return stringify(r,r.e<=t.NE||r.e>=t.PE,!0)};export var Big=_Big_();export default Big;